<div class="container pt-3">
    <h3 class="pm-title">Registrar Entrega</h3>
</div>
<div class="container" [formGroup]="form">
    <div class="card-deck pt-3 pb-3">
        <div class="card card--shadow">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 col-sm-12">
                        <label class="pm-label" for="transporte">Transporte</label>
                        <pm-auto-complete
                            class="auto-complete"
                            id="transporte"
                            [config]="configTransporte"
                            (selected)="setTransporte($event)"
                            (filteredInput)="getTransportes($event)">
                        </pm-auto-complete>
                    </div>
                    <div class="col-md-6 col-sm-12">
                        <label class="pm-label pr-5" style="margin-top: 2.5rem;">Nº de Entrega:</label>
                        <span>{{model ? model.nroEntrega : ''}}</span>
                    </div>
                </div>
                <hr>
                <div class="row pt-2">
                    <div class="col-xs-5 col-md-3 pt-2">
                        <span class="pm-label">Nº Transporte:</span>
                    </div>
                    <div class="col-xs-6 col-md-3 pt-2">
                        {{transporte ? transporte.nroTransporte : ''}}
                    </div>
                    <div class="col-xs-5 col-md-3 pt-2">
                        <span class="pm-label">Placa del Vehículo:</span>
                    </div>
                    <div class="col-xs-6 col-md-3 pt-2">
                        {{transporte ? transporte.vehiculoPlaca : ''}}
                    </div>
                </div>
                <div style="border: 1px solid black" class="mt-3 p-2" *ngIf="transporte !== undefined">
                    <div class="row">
                        <div class="col-sm-12">
                            <span>El vehículo con placa {{transporte.vehiculoPlaca}} tiene:</span>
                            <br/>
                            <span>- Capacidad de carga de {{transporte.vehiculoCarga}}</span>
                            <br/>
                            <span>- Capacidad volumetrica de: {{transporte.vehiculoVolumetria}}</span>
                        </div>
                    </div>
                </div>
                <div class="row pt-2">
                    <div class="col-xs-5 col-md-3 pt-2">
                        <span class="pm-label">Sucursal Salida:</span>
                    </div>
                    <div class="col-xs-6 col-md-3 pt-2">
                        {{transporte ? transporte.sucursalSalidaNombre + ' - ' + transporte.sucursalSalidaDepartamento : ''}}
                    </div>
                    <div class="col-xs-5 col-md-3 pt-2">
                        <span class="pm-label">Fecha - Hora Salida:</span>
                    </div>
                    <div class="col-xs-6 col-md-3 pt-2">
                        {{transporte ? (transporte.fechaSalida | date:'dd/MM/yyyy hh:mm a') : ''}}
                    </div>
                </div>
                <div class="row pt-2">
                    <div class="col-xs-5 col-md-3 pt-2">
                        <span class="pm-label">Sucursal Llegada:</span>
                    </div>
                    <div class="col-xs-6 col-md-3 pt-2">
                        {{transporte ? transporte.sucursalLlegadaNombre + ' - ' + transporte.sucursalLlegadaDepartamento : ''}}
                    </div>
                    <div class="col-xs-5 col-md-3 pt-2">
                        <span class="pm-label">Fecha - Hora Llegada:</span>
                    </div>
                    <div class="col-xs-6 col-md-3 pt-2">
                        {{transporte ? (transporte.fechaLlegada | date:'dd/MM/yyyy hh:mm a') : ''}}
                    </div>
                </div>
                <div class="row pt-2">
                    <div class="col-xs-5 col-md-3 pt-2">
                        <span class="pm-label">Chofer Vehículo:</span>
                    </div>
                    <div class="col-xs-6 col-md-3 pt-2">
                        {{transporte ? transporte.colaboradorChoferNombre : ''}}
                    </div>
                    <div class="col-xs-5 col-md-3 pt-2">
                        <span class="pm-label">Auxiliar Vehículo:</span>
                    </div>
                    <div class="col-xs-6 col-md-3 pt-2">
                        {{transporte ? transporte.colaboradorAuxiliarNombre : ''}}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <h5 class="pm-title">Clientes</h5>
    <div class="card-deck pt-3 pb-3">
        <div class="card card--shadow">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 col-sm-12 mb-3">
                        <label class="pm-label" for="remitente">Remitente</label>
                        <pm-auto-complete class="auto-complete" id="remitente" [config]="configRemitente" (selected)="setRemitente($event)" (filteredInput)="getRemitentes($event)">
                        </pm-auto-complete>
                    </div>
                    <div class="col-md-6 col-sm-12 mb-3">
                        <label class="pm-label" for="destinatario">Destinatario</label>
                        <pm-auto-complete class="auto-complete" id="destinatario" [config]="configDestinatario" (selected)="setDestinatario($event)" (filteredInput)="getDestinatarios($event)">
                        </pm-auto-complete>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <h5 class="pm-title">Entrega</h5>
    <div class="card-deck pt-3 pb-3">
        <div class="card card--shadow">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 col-sm-12 mb-3">
                        <label class="pm-label" for="salida">Sucursal Origen</label>
                        <pm-auto-complete class="auto-complete" id="salida" [config]="configSucursalSalida" (selected)="setSucursalSalida($event)" (filteredInput)="getSucursalesSalida($event)">
                        </pm-auto-complete>
                    </div>
                    <div class="col-md-6 col-sm-12 mb-3">
                        <div style="margin-top: 2rem">
                            <input type="text" formControlName="sucursalSalidaDescripcion" class="form-control pm-input" placeholder="Sucursal de salida">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 col-sm-12 mb-3">
                        <label class="pm-label" for="llegada">Sucursal Destino</label>
                        <pm-auto-complete class="auto-complete" id="llegada" [config]="configSucursalLlegada" (selected)="setSucursalLlegada($event)" (filteredInput)="getSucursalesLlegada($event)">
                        </pm-auto-complete>
                    </div>
                    <div class="col-md-6 col-sm-12 mb-3">
                        <div style="margin-top: 2rem">
                            <input type="text" formControlName="sucursalLlegadaDescripcion" class="form-control pm-input" placeholder="Sucursal de llegada">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-3 col-sm-12 mb-3">
                        <label class="pm-label">Fecha Entrega</label>
                        <div>
                            <p-calendar formControlName="fechaEntrega" dateFormat="dd/mm/yy" showIcon="true" [locale]="formatoFechas">
                            </p-calendar>
                        </div>
                        <div style="color: red;" *ngIf="validarFechas()">
                            La fecha de entrega debe estar entre la fecha de salida y la de llegada
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-12 mb-3">
                        <label class="pm-label">Hora Entrega</label>
                        <div>
                            <p-calendar formControlName="horaEntrega" timeOnly="true" hourFormat="12">
                            </p-calendar>
                        </div>
                    </div>
                </div>
                <hr>
                <div class="row">
                    <div class="col-md-2 col-sm-12 mb-3 pl-4">
                        <label class="btn btn-primary pm-button" for="file">Seleccionar Archivo</label>
                        <input #attachInput type="file" id="file" (change)="handleFileInput($event.target.files)" class="form-control file-input">
                        <input type="hidden" formControlName="nombreGuiaRemitente">
                    </div>
                    <div style="color: red; padding-top: 1rem;" *ngIf="invalidDocumento">
                        Debe adjuntar un archivo
                    </div>
                    <div class="col-md-6 col-sm-12 mb-3" style="padding-top: 1rem;">
                        <b>{{guiaRemitenteFile ? guiaRemitenteFile.name : model ? model.guiaRemitenteNombreGuia : ''}}</b>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 col-sm-12 mb-3">
                        <label class="pm-label" for="numeroGuia">Nº de Guía Remitente</label>
                        <input type="text" formControlName="nroGuiaRemitente" id="numeroGuia" class="form-control pm-input" placeholder="Nº de Guía de Remitente" [ngClass]="{'is-invalid': formValidation('nroGuiaRemitente')}">
                    </div>
                    <div class="col-md-3 col-sm-12 mb-3">
                        <label class="pm-label" for="numeroBulto">Nro. de Bultos</label>
                        <input type="text" formControlName="nroBultoRemitente" id="numeroBulto" class="form-control pm-input" placeholder="Nro. de Bultos" [ngClass]="{'is-invalid': formValidation('nroBultoRemitente')}">
                    </div>
                    <div class="col-md-3 col-sm-12 mb-3">
                        <label class="pm-label" for="numeroBulto">Volumen</label>
                        <input type="text" formControlName="volumenRemitente" id="volumen" class="form-control pm-input" placeholder="Volumen" [ngClass]="{'is-invalid': formValidation('volumenRemitente')}">
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="card-deck pt-2 mb-3" [class.hide]="!showBarcodes" *ngIf="model">
        <div class="card card--shadow">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 col-sm-12 mb-3">
                        <svg id="CodigoBarra" jsbarcode-format="EAN13" [attr.jsbarcode-value]="model.codBarraEntrega"></svg>
                    </div>
                    <div class="col-md-6 col-sm-12 mb-3 pt-5">
                        <button type="button" class="btn pm-button" (click)="saveBarCodePDF('CodigoBarra')">Imprimir</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="card-deck pt-2 mb-3" [class.hide]="!showBarcodes" *ngIf="model">
        <div class="card card--shadow">
            <div class="card-body">
                <div class="row" *ngFor="let barCode of model.rotulo">
                    <div class="col-md-6 col-sm-12 mb-3">
                        <svg id="{{'Rotulo-' + barCode.id}}" jsbarcode-format="EAN8" [attr.jsbarcode-value]="barCode.codBarraRotulo"></svg>
                    </div>
                    <div class="col-md-6 col-sm-12 mb-3 pt-5">
                        <button type="button" class="btn pm-button" (click)="saveBarCodePDF('Rotulo-' + barCode.id)">Imprimir</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row" *ngIf="mostrarMensajeExito">
        <div class="col-md-12 col-sm-12 mb-3">
            <alert type="success">
                <div [innerHTML]="mensajeExito"></div>
            </alert>
        </div>
    </div>

    <div class="row" *ngIf="mostrarMensajeError">
        <div class="col-md-12 col-sm-12 mb-3">
            <alert type="danger">
                <div [innerHTML]="mensajeError"></div>
            </alert>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12 col-sm-12 mb-3">
            <button type="button" class="btn btn-primary float-md-right mr-3 mb-3 pm-button" (click)="save()" [attr.disabled]="mostrarMensajeExito">Grabar</button>
            <button type="button" class="btn btn-primary float-md-right mr-3 mb-3 pm-button" *ngIf="mostrarVerGuiaTransporte" (click)="verGuiaTransporte()">Ver Guía de Transporte</button>
            <button type="button" class="btn btn-primary float-md-right mr-3 mb-3 pm-button" *ngIf="mostrarVerEntregas" (click)="verEntregas()">Ver Entregas</button>
            <button type="button" class="btn btn-primary float-md-right mr-3 mb-3 pm-button" *ngIf="mostrarRegresar" (click)="regresar()">Regresar</button>
            <button type="button" class="btn btn-dark float-md-right mr-3 mb-3 pm-button" *ngIf="mostrarEliminar" (click)="confirmDelete()">Eliminar</button>
            <button type="button" class="btn btn-dark float-md-right mr-3 mb-3 pm-button" *ngIf="mostrarCodigos" (click)="showCodes()">Ver Códigos de Barra</button>
        </div>
    </div>
</div>